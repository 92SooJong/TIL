카카오 광고 추천팀에서 근무중이심 (데브원영 유튜버)

스마트 메세지 시스템 - 원하는 사용자들에게만 메시지를 전달하는 needs. 반응 로그를 수집해서 전송할 사람을 추려냈음. 카프카 스트림즈와 커넥트를 같이 활용했다.

스트림즈란? 
- 실시간으로 들어오는 데이터를 처리하는 라이브러리.
- 플링크, 스파크스트리밍과 유사함.

파티션 간에는 순서를 보장하지 못한다. 

토픽을 다른 브로커에 복사해서 둔다. 한번 파티션에 보내더라도 복제된 파티션으로도 송신이된다. (복제 개수를 2정도로 했다. 안정성이 중요해지면 3개로 했다.)

커밋된 오프셋은 인터널 토픽에 저장되어 있음. 컨슈머가 어디까지 가져갔는지 기록하고 있음.

메시지 키가 같은 경우는 항상 똑같은 파티션으로 간다.

토픽에 지정된 세팅값에 따라 (디폴트는 7일) 레코드를 보관하는 기간이 달라진다.

동일한 역할을 하는 컨슈머를 하나의 묶음으로 된것이 컨슈머 그룹

컨슈머 그룹은 목적에 따라 하나씩 만드는게 맞다.(이유는? 장애 커플링을 해소하기 위함이다.)

이벤트 스트리밍 데이터
- 이벤트 시간과 처리 시간. (이벤트 시간은 시스템에 들어온 시간이 아님!!)
- 이벤트 시간과 처리 시간 중 어디에 초점을 맞출 것인지 결정해야함.
- 이벤트 시간에 집중하는게 카프카 스트림즈임.
- 재처리 - 래빗 앰큐처럼 다시 publish하는 방법은 별로다.
- 상태, 비상태 기반 - 비상태 기반은 개별 이벤트 데이터를 개별적으로 처리하면 되는것임. 딱히 고급 기술이 필요하지 않음. 데이터의 묶음으로 데이터를 처리해야하는 경우는 상태 기반이 중요해짐.

impression, click의 간격이 10분이내인지 판단해서 실수인지? 진짜 좋아서 누른건지 판단가능. 광고노출 스트림, 광고 클릭 스티림을 각각 수집해서 합쳐지는 시간을 측정하는게 관건.

몽고 디비측에서 카프카 커넥트 사용을 위한 jar제공한다.

- 질문. 소스 커넥터를 사용했는데 데이터를 삭제했다면 어떻게 하느냐?
답: RDB랑 연동하는 케이스가 없다.


10개 파티션이 있는 경우 10개 스트림즈 애플리케이션을 띄우고 1개 태스트를 가지도록 하는게 이상적이었다.(쓰레드를 1개로 유지하자)

KTable과 KStream에 대해서 학습해보기. KTable쓰면 레디스 보다 좋아보이는데?? KTable은 토픽에 있는 전체 레코드로 테이블을 만들어버린다. 

동일한 유저에 대해서 동일한 태스크로 가게된다. 토픽이 다른 파티션 0번이 같은 태스크 0번으로 가는것을 보장한다.

코파티셔닝이란 조인을 하는 2개 데이터의 파티션 개수가 동일하고 파티셔닝 전략을 동일하게 맞추는 작업이다.(조인하려면 반드시 코파티셔닝이 되어야함!! 하지않으면 토폴로지에러남)

코파티셔닝되지 않은 Kstream과 ktable을 조인하고 싶다면 Ktable을 GlobalKTable을 선언하여 사용하면 된다.(작은용량의 데이터를 활용할때만 사용함)

KsqlDB에 대해서 공부해보기
- Poc결과 사용안했음. adhoc쿼리를 지원하지 않음. sql형태로 프로세싱하는것이지 뭘 뽑아내기위해 사용하는 도구가 아님. select를 하면 데이터가 지속적으로 그냥 나옴. 딱 뽑아내는게 아님. 운영이 너무 어려웠음(히스토리 관리가 안됨. CLI로는 운영 난이도가 높다) 따라서 카프카 스트림즈를 아직 활용중이다.

ofTimeDifferenceAndGrace 메소드에 대해서 이해하기

광고 데이터쪽에 좋은 예제가 많다. 단 영어로 찾아야함. impression, click 등

파티션 쏠림 현상 같은게 있을떄 Producing을 할때 커스텀 파티셔너를 사용하면 된다.

