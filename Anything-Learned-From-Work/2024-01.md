# 2024-01-24

filebeat Container가 바라보고 있는 Volume의 용량이 모두 차버려서 filebeat Container가 죽어버렸다. 그결과 Pod 자체가 EKS Cluster에서 축출되었다.

확인을 해보니까 예상보다 빠르게 log file의 용량이 증가하고 있었다. 원인은 두가지였는데...

1. log 레벨이 INFO였다.
2. logback-spring.xml에 작성한 정책이 있었는데 아카이빙을 1일에 1번 시도하고, 최대 800MB까지 아카이빙을 했다. 그리고 해당 아카이빙을 7일간 보관했다. 결국 정리하면 아카이빙 파일은 최대 800MB까지 적재가 가능한 것이다. 문제는 로깅을 위해 마련한 볼륨의 최대 용량이 1GB였다.

INFO 레벨로 로그를 쌓으니까 용량 증가 속도가 엄청 났다. 그런데 아카이빙 파일 정리 주기도 7일이나 되고 아카이빙 시도도 하루에 1번만 하니까 증가하는 로그용량을 제어할 수단이 없었다. 거기다 아카이빙을 800MB이나 한다... 아무튼 로그 레벨을 WARN으로 수정하고, 아카이빙 파일 보관일수 줄이고, 아카이빙 주기도 줄여서 문제를 해결했음.

